/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package org.iesapp.apps.administrador.bimodules;

import ch.swingfx.twinkle.NotificationBuilder;
import ch.swingfx.twinkle.style.INotificationStyle;
import ch.swingfx.twinkle.style.theme.DarkDefaultNotification;
import ch.swingfx.twinkle.window.Positions;
import java.awt.Color;
import java.awt.GradientPaint;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;
import java.io.IOException;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.DefaultComboBoxModel;
import javax.swing.DefaultListModel;
import javax.swing.ImageIcon;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.filechooser.FileFilter;
import javax.swing.text.BadLocationException;
import jsyntaxpane.DefaultSyntaxKit;
import org.iesapp.apps.administrador.Cfg;
import org.iesapp.apps.administrador.actions.HtmlEditorDlg;
import org.iesapp.apps.administrador.actions.beans.BeanReport;
import org.iesapp.apps.administrador.actions.beans.BeanRule;
import org.iesapp.apps.administrador.actions.beans.BeanSubRule;
import org.iesapp.apps.administrador.jasperreports.FixDlg;
import org.iesapp.apps.administrador.jasperreports.JasperCompileModule;
import org.iesapp.apps.administrador.jasperreports.JasperReportParser;
import org.iesapp.clients.iesdigital.actuacions.Actuacio;
import org.iesapp.clients.iesdigital.actuacions.FactoryRules;
import org.iesapp.framework.actuacions.CreateUI;
import org.iesapp.framework.data.RolesChooser;
import org.iesapp.framework.util.CoreCfg;
import org.iesapp.util.DataCtrl;
import org.iesapp.util.StringUtils;
 

/**
 *
 * @author Josep
 */
public class RulesManager extends org.iesapp.framework.pluggable.TopModuleWindow {
    private final ArrayList<BeanRule> allRules;
    private final DefaultListModel modelList1;
    private DefaultListModel modelList2;
    private DefaultListModel modelList4;
    private File lastDir;
    private boolean isListening;
    //localitzadors
    private int idMain=-1;
    private int idSec=-1;
    private int idRep=-1;
    
    private BeanRule pointerMain=null;
    private BeanSubRule pointerSec=null;
    private BeanReport pointerRep=null;
    private final Cfg cfg;
    private JasperReportParser jasperParser;
    private ActionListener actionListener;
    private boolean initialized = false;

    /**
     * Creates new form RulesManager
     */
    public RulesManager(final Cfg cfg) {
        this.cfg = cfg;
        this.moduleDescription = "Rules manager";
        this.moduleDisplayName = "Rules manager";
        this.moduleName = "rulesManager";
                 
        lastDir = new File(CoreCfg.contextRoot+"\\reports");
        DefaultSyntaxKit.initKit();        
        initComponents();
        jEditorPane4.setContentType("text/xml");
        
        DefaultComboBoxModel modelCombo = new DefaultComboBoxModel();
        modelCombo.addElement("");
        for(String s: cfg.getCoreCfg().getIesClient().getFitxesClient().getSGDImporterConfig().getColumnFields())
        {
            modelCombo.addElement(s);
        }
        jComboBox9.setModel(modelCombo);
        //Load rules and subrules
        //This is a very time-consuming procedure
        //Replace it by getAllRulesLazyLoading()
        allRules = BeanRule.getAllRulesLazyLoading(cfg);
        
        modelList1 = new DefaultListModel();       
        for(int i=0; i<allRules.size(); i++)
        {
            BeanRule cr = allRules.get(i);
            modelList1.addElement(cr.getId()+" : "+cr.getActuacio());
        }
        jList1.setModel(modelList1);
        if(!modelList1.isEmpty())
        {
            jList1.setSelectedIndex(0);
        }
        
        isListening = true;
        
        jTextPane4.setDocument(FactoryRules.getLogger());
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollPane5 = new javax.swing.JScrollPane();
        jTextPane1 = new javax.swing.JTextPane();
        jScrollPane1 = new javax.swing.JScrollPane();
        jList1 = new javax.swing.JList();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jScrollPane2 = new javax.swing.JScrollPane();
        jList2 = new javax.swing.JList();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jScrollPane3 = new javax.swing.JScrollPane();
        jPanel2 = new javax.swing.JPanel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jTextField1 = new javax.swing.JTextField();
        jTextField2 = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        jTextField3 = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        jComboBox1 = new javax.swing.JComboBox();
        jPanel4 = new javax.swing.JPanel();
        jLabel7 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        jSpinField1 = new com.toedter.components.JSpinField();
        jCheckBox10 = new javax.swing.JCheckBox();
        jComboBox9 = new javax.swing.JComboBox();
        jCheckBox3 = new javax.swing.JCheckBox();
        jPanel5 = new javax.swing.JPanel();
        jLabel9 = new javax.swing.JLabel();
        jTextField5 = new javax.swing.JTextField();
        jLabel25 = new javax.swing.JLabel();
        jTextField16 = new javax.swing.JTextField();
        jPanel6 = new javax.swing.JPanel();
        jCheckBox1 = new javax.swing.JCheckBox();
        jLabel13 = new javax.swing.JLabel();
        jTextField7 = new javax.swing.JTextField();
        jTextField6 = new javax.swing.JTextField();
        jLabel10 = new javax.swing.JLabel();
        jLabel11 = new javax.swing.JLabel();
        jTextField8 = new javax.swing.JTextField();
        jCheckBox4 = new javax.swing.JCheckBox();
        jCheckBox5 = new javax.swing.JCheckBox();
        jButton1 = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();
        jCheckBox6 = new javax.swing.JCheckBox();
        jScrollPane10 = new javax.swing.JScrollPane();
        jTextPane2 = new javax.swing.JTextPane();
        jScrollPane11 = new javax.swing.JScrollPane();
        jTextPane3 = new javax.swing.JTextPane();
        jToolBar3 = new javax.swing.JToolBar();
        jEdit1 = new javax.swing.JButton();
        jSave1 = new javax.swing.JButton();
        jCancel1 = new javax.swing.JButton();
        jLabel23 = new javax.swing.JLabel();
        jTextField13 = new javax.swing.JTextField();
        jPanel11 = new javax.swing.JPanel();
        jCheckBox2 = new javax.swing.JCheckBox();
        jPanel12 = new javax.swing.JPanel();
        jLabel26 = new javax.swing.JLabel();
        jLabel34 = new javax.swing.JLabel();
        jLabel30 = new javax.swing.JLabel();
        jSpinField6 = new com.toedter.components.JSpinField();
        jSpinField5 = new com.toedter.components.JSpinField();
        jLabel35 = new javax.swing.JLabel();
        jTextField19 = new javax.swing.JTextField();
        jScrollPane4 = new javax.swing.JScrollPane();
        jPanel3 = new javax.swing.JPanel();
        jLabel12 = new javax.swing.JLabel();
        jLabel14 = new javax.swing.JLabel();
        jLabel15 = new javax.swing.JLabel();
        jPanel7 = new javax.swing.JPanel();
        jLabel16 = new javax.swing.JLabel();
        jLabel17 = new javax.swing.JLabel();
        jLabel18 = new javax.swing.JLabel();
        jComboBox2 = new javax.swing.JComboBox();
        jSpinField2 = new com.toedter.components.JSpinField();
        jSpinField3 = new com.toedter.components.JSpinField();
        jTextField9 = new javax.swing.JTextField();
        jTextField10 = new javax.swing.JTextField();
        jTextField11 = new javax.swing.JTextField();
        jCheckBox7 = new javax.swing.JCheckBox();
        jLabel19 = new javax.swing.JLabel();
        jTextField14 = new javax.swing.JTextField();
        jTextField15 = new javax.swing.JTextField();
        jLabel20 = new javax.swing.JLabel();
        jToolBar4 = new javax.swing.JToolBar();
        jEdit2 = new javax.swing.JButton();
        jSave2 = new javax.swing.JButton();
        jCancel2 = new javax.swing.JButton();
        jPanel8 = new javax.swing.JPanel();
        jToolBar1 = new javax.swing.JToolBar();
        jEdit3 = new javax.swing.JButton();
        jSave3 = new javax.swing.JButton();
        jCancel3 = new javax.swing.JButton();
        jLabel21 = new javax.swing.JLabel();
        jComboBox3 = new javax.swing.JComboBox();
        jButton3 = new javax.swing.JButton();
        jButton4 = new javax.swing.JButton();
        jButton5 = new javax.swing.JButton();
        jComboBox8 = new javax.swing.JComboBox();
        jToolBar2 = new javax.swing.JToolBar();
        jLabel22 = new javax.swing.JLabel();
        jComboBox4 = new javax.swing.JComboBox();
        jButton6 = new javax.swing.JButton();
        jButton15 = new javax.swing.JButton();
        jScrollPane9 = new javax.swing.JScrollPane();
        jEditorPane4 = new javax.swing.JEditorPane();
        jScrollPane8 = new javax.swing.JScrollPane();
        jPanel1 = new javax.swing.JPanel();
        mainPane = new com.l2fprod.common.swing.JTaskPane(){
            //Add a gradient background
            @Override
            public void paintComponent(Graphics g)
            {
                Graphics2D g2d = (Graphics2D)g;
                int w = getWidth();
                int h = getHeight();
                GradientPaint gp = new GradientPaint(w, 0, new Color(200,200,150), 0, h, Color.WHITE);
                g2d.setPaint(gp);
                g2d.fillRect(0, 0, w, h);
            }
        };
        jScrollPane12 = new javax.swing.JScrollPane();
        jTextPane4 = new javax.swing.JTextPane();
        jPanel9 = new javax.swing.JPanel();
        jButton11 = new javax.swing.JButton();
        jButton12 = new javax.swing.JButton();
        jScrollPane7 = new javax.swing.JScrollPane();
        jList4 = new javax.swing.JList();
        jPanel10 = new javax.swing.JPanel();
        jLabel24 = new javax.swing.JLabel();
        jLabel27 = new javax.swing.JLabel();
        jLabel28 = new javax.swing.JLabel();
        jTextField12 = new javax.swing.JTextField();
        jTextField17 = new javax.swing.JTextField();
        jTextField18 = new javax.swing.JTextField();
        jButton13 = new javax.swing.JButton();
        jLabel29 = new javax.swing.JLabel();
        jComboBox5 = new javax.swing.JComboBox();
        jLabel31 = new javax.swing.JLabel();
        jComboBox6 = new javax.swing.JComboBox();
        jLabel32 = new javax.swing.JLabel();
        jSpinField4 = new com.toedter.components.JSpinField();
        jLabel33 = new javax.swing.JLabel();
        jComboBox7 = new javax.swing.JComboBox();
        jCheckBox8 = new javax.swing.JCheckBox();
        jCheckBox9 = new javax.swing.JCheckBox();
        jScrollPane6 = new javax.swing.JScrollPane();
        jTextArea1 = new javax.swing.JTextArea();
        jToolBar5 = new javax.swing.JToolBar();
        jEdit4 = new javax.swing.JButton();
        jSave4 = new javax.swing.JButton();
        jCancel4 = new javax.swing.JButton();
        jButton14 = new javax.swing.JButton();
        jButton16 = new javax.swing.JButton();
        jLinkButton1 = new com.l2fprod.common.swing.JLinkButton();
        jLinkButton2 = new com.l2fprod.common.swing.JLinkButton();
        jButton7 = new javax.swing.JButton();
        jButton8 = new javax.swing.JButton();
        jButton9 = new javax.swing.JButton();
        jButton10 = new javax.swing.JButton();

        jScrollPane5.setViewportView(jTextPane1);

        jList1.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        jList1.addListSelectionListener(new javax.swing.event.ListSelectionListener() {
            public void valueChanged(javax.swing.event.ListSelectionEvent evt) {
                jList1ValueChanged(evt);
            }
        });
        jScrollPane1.setViewportView(jList1);

        jLabel1.setText("Rules");

        jLabel2.setText("SubRules");

        jList2.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        jList2.addListSelectionListener(new javax.swing.event.ListSelectionListener() {
            public void valueChanged(javax.swing.event.ListSelectionEvent evt) {
                jList2ValueChanged(evt);
            }
        });
        jScrollPane2.setViewportView(jList2);

        jTabbedPane1.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                jTabbedPane1StateChanged(evt);
            }
        });

        jLabel3.setText("Nom llarg actuació");

        jLabel4.setText("Nom curt actuació");

        jTextField1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField1ActionPerformed(evt);
            }
        });
        jTextField1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTextField1KeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jTextField1KeyTyped(evt);
            }
        });

        jLabel5.setText("Id assignada");

        jTextField3.setEditable(false);

        jLabel6.setText("Categoria");

        jComboBox1.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "ASSISTENCIA", "CONVIVENCIA" }));

        jPanel4.setBorder(javax.swing.BorderFactory.createTitledBorder("Activació"));

        jLabel7.setText("Grup de Simbols d'incidència");

        jLabel8.setText("Valor d'activació");

        jCheckBox10.setText("Avisar com a tasca pendent");

        jComboBox9.setToolTipText("Identificadors que són importats des de SGD");

        org.jdesktop.layout.GroupLayout jPanel4Layout = new org.jdesktop.layout.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .add(jLabel7)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jComboBox9, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 82, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jLabel8)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jSpinField1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 58, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .add(18, 18, 18)
                .add(jCheckBox10)
                .addContainerGap(221, Short.MAX_VALUE))
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel4Layout.createSequentialGroup()
                .add(3, 3, 3)
                .add(jPanel4Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jCheckBox10)
                    .add(jPanel4Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                        .add(jLabel7)
                        .add(jLabel8)
                        .add(jComboBox9, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                    .add(jSpinField1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(2, 2, 2))
        );

        jCheckBox3.setText("Només ADMIN / PREF");

        jPanel5.setBorder(javax.swing.BorderFactory.createTitledBorder("Iniciació"));

        jLabel9.setText("Requereix tancades Ids");

        jLabel25.setText("Requereix creades Ids");

        org.jdesktop.layout.GroupLayout jPanel5Layout = new org.jdesktop.layout.GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(
            jPanel5Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .add(jPanel5Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
                    .add(jPanel5Layout.createSequentialGroup()
                        .add(jLabel25)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .add(jTextField16, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 322, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                    .add(jPanel5Layout.createSequentialGroup()
                        .add(jLabel9)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jTextField5, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 322, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel5Layout.setVerticalGroup(
            jPanel5Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel5Layout.createSequentialGroup()
                .add(3, 3, 3)
                .add(jPanel5Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel9)
                    .add(jTextField5, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel5Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jTextField16, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(jLabel25))
                .addContainerGap())
        );

        jPanel6.setBorder(javax.swing.BorderFactory.createTitledBorder("Tancament"));

        jCheckBox1.setText("Auto tancar-se");

        jLabel13.setText("Equivalent a actuacions amb Ids");

        jTextField7.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField7ActionPerformed(evt);
            }
        });

        org.jdesktop.layout.GroupLayout jPanel6Layout = new org.jdesktop.layout.GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(
            jPanel6Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .add(jCheckBox1)
                .add(18, 18, 18)
                .add(jLabel13)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jTextField7)
                .addContainerGap())
        );
        jPanel6Layout.setVerticalGroup(
            jPanel6Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel6Layout.createSequentialGroup()
                .add(2, 2, 2)
                .add(jPanel6Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jCheckBox1)
                    .add(jLabel13)
                    .add(jTextField7, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
        );

        jTextField6.setText("jTextField6");

        jLabel10.setText("Missatge d'avís");

        jLabel11.setText("*Avançat: Classe del formulari");

        jTextField8.setEnabled(false);

        jCheckBox4.setText("Instruccions");

        jCheckBox5.setText("Reglament");

        jButton1.setText("Edit");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        jButton2.setText("Edit");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });

        jCheckBox6.setSelected(true);
        jCheckBox6.setText("Default");
        jCheckBox6.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBox6ActionPerformed(evt);
            }
        });

        jTextPane2.setEditable(false);
        jTextPane2.setContentType("text/html"); // NOI18N
        jScrollPane10.setViewportView(jTextPane2);

        jTextPane3.setEditable(false);
        jTextPane3.setContentType("text/html"); // NOI18N
        jScrollPane11.setViewportView(jTextPane3);

        jToolBar3.setFloatable(false);
        jToolBar3.setRollover(true);

        jEdit1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/edit.gif"))); // NOI18N
        jEdit1.setToolTipText("Edit");
        jEdit1.setFocusable(false);
        jEdit1.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jEdit1.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jEdit1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jEdit1ActionPerformed(evt);
            }
        });
        jToolBar3.add(jEdit1);

        jSave1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/save.gif"))); // NOI18N
        jSave1.setToolTipText("Save");
        jSave1.setEnabled(false);
        jSave1.setFocusable(false);
        jSave1.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jSave1.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jSave1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jSave1ActionPerformed(evt);
            }
        });
        jToolBar3.add(jSave1);

        jCancel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/exit.gif"))); // NOI18N
        jCancel1.setToolTipText("Cancel");
        jCancel1.setEnabled(false);
        jCancel1.setFocusable(false);
        jCancel1.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jCancel1.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jCancel1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCancel1ActionPerformed(evt);
            }
        });
        jToolBar3.add(jCancel1);

        jLabel23.setText("For Roles");

        jTextField13.setEditable(false);
        jTextField13.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTextField13MouseClicked(evt);
            }
        });
        jTextField13.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField13ActionPerformed(evt);
            }
        });

        jPanel11.setBorder(javax.swing.BorderFactory.createTitledBorder("Repeticio"));

        jCheckBox2.setText("Repetir");
        jCheckBox2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBox2ActionPerformed(evt);
            }
        });

        jLabel26.setText("cada");

        jLabel34.setText("* 0=no limit");

        jLabel30.setText("fins*");

        org.jdesktop.layout.GroupLayout jPanel12Layout = new org.jdesktop.layout.GroupLayout(jPanel12);
        jPanel12.setLayout(jPanel12Layout);
        jPanel12Layout.setHorizontalGroup(
            jPanel12Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel12Layout.createSequentialGroup()
                .addContainerGap()
                .add(jLabel26)
                .add(10, 10, 10)
                .add(jSpinField6, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 58, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .add(18, 18, 18)
                .add(jLabel30)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jSpinField5, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 58, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                .add(jLabel34)
                .addContainerGap())
        );
        jPanel12Layout.setVerticalGroup(
            jPanel12Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel12Layout.createSequentialGroup()
                .add(0, 0, 0)
                .add(jPanel12Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
                    .add(org.jdesktop.layout.GroupLayout.TRAILING, jSpinField6, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .add(org.jdesktop.layout.GroupLayout.TRAILING, jSpinField5, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .add(org.jdesktop.layout.GroupLayout.TRAILING, jLabel30, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .add(org.jdesktop.layout.GroupLayout.TRAILING, jLabel26, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .add(jLabel34, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        org.jdesktop.layout.GroupLayout jPanel11Layout = new org.jdesktop.layout.GroupLayout(jPanel11);
        jPanel11.setLayout(jPanel11Layout);
        jPanel11Layout.setHorizontalGroup(
            jPanel11Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel11Layout.createSequentialGroup()
                .add(jCheckBox2)
                .add(18, 18, 18)
                .add(jPanel12, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel11Layout.setVerticalGroup(
            jPanel11Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel11Layout.createSequentialGroup()
                .add(jPanel11Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
                    .add(jCheckBox2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .add(jPanel12, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 0, Short.MAX_VALUE))
                .add(0, 8, Short.MAX_VALUE))
        );

        jLabel35.setText("Paràmetres addicionals");

        jTextField19.setToolTipText("Mapa: key1={value1};key2={value2};etc.");

        org.jdesktop.layout.GroupLayout jPanel2Layout = new org.jdesktop.layout.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel2Layout.createSequentialGroup()
                        .add(26, 26, 26)
                        .add(jLabel4)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jTextField1)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jLabel5)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jTextField3, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 87, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                        .add(257, 257, 257))
                    .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel2Layout.createSequentialGroup()
                        .add(4, 4, 4)
                        .add(jToolBar3, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 833, Short.MAX_VALUE))
                    .add(jPanel2Layout.createSequentialGroup()
                        .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
                            .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel2Layout.createSequentialGroup()
                                .add(jCheckBox5)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(jButton2))
                            .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel2Layout.createSequentialGroup()
                                .add(jCheckBox4)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(jButton1))
                            .add(org.jdesktop.layout.GroupLayout.LEADING, jScrollPane11, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 722, Short.MAX_VALUE)
                            .add(org.jdesktop.layout.GroupLayout.LEADING, jScrollPane10))
                        .addContainerGap())
                    .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel2Layout.createSequentialGroup()
                        .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                            .add(jPanel2Layout.createSequentialGroup()
                                .add(jLabel11)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(jTextField8, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 266, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(jCheckBox6, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                            .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel11, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .add(jPanel2Layout.createSequentialGroup()
                                .add(jLabel10)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(jTextField6))
                            .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel6, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel5, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel4, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel2Layout.createSequentialGroup()
                                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                                    .add(jLabel3)
                                    .add(jLabel6)
                                    .add(jLabel35))
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                    .add(jPanel2Layout.createSequentialGroup()
                                        .add(jComboBox1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 137, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                        .add(18, 18, 18)
                                        .add(jCheckBox3)
                                        .add(18, 18, 18)
                                        .add(jLabel23)
                                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                        .add(jTextField13))
                                    .add(jTextField2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 668, Short.MAX_VALUE)
                                    .add(jTextField19))))
                        .add(55, 55, 55))))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel2Layout.createSequentialGroup()
                .add(jToolBar3, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 24, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel4)
                    .add(jTextField1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(jLabel5)
                    .add(jTextField3, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel3)
                    .add(jTextField2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                        .add(jCheckBox3)
                        .add(jLabel23)
                        .add(jTextField13, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                    .add(jPanel2Layout.createSequentialGroup()
                        .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                            .add(jLabel6)
                            .add(jComboBox1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                            .add(jLabel35)
                            .add(jTextField19, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel4, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .add(3, 3, 3)
                .add(jPanel11, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel5, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 75, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel6, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jTextField6, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(jLabel10))
                .add(11, 11, 11)
                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel11)
                    .add(jTextField8, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(jCheckBox6))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jCheckBox4)
                    .add(jButton1))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jScrollPane11, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 125, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jCheckBox5)
                    .add(jButton2))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jScrollPane10, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 125, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jScrollPane3.setViewportView(jPanel2);

        jTabbedPane1.addTab("General", jScrollPane3);

        jLabel12.setText("Id assignada");

        jLabel14.setText("Ensenyament");

        jLabel15.setText("Estudis");

        jPanel7.setBorder(javax.swing.BorderFactory.createTitledBorder("Aplicabilitat"));

        jLabel16.setText("min Age");

        jLabel17.setText("max Age");

        jLabel18.setText("Politica d'instàncies múltiples");

        jComboBox2.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "SINGLE", "MULTIPLE", "MULTIPLE_WAIT" }));

        org.jdesktop.layout.GroupLayout jPanel7Layout = new org.jdesktop.layout.GroupLayout(jPanel7);
        jPanel7.setLayout(jPanel7Layout);
        jPanel7Layout.setHorizontalGroup(
            jPanel7Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel7Layout.createSequentialGroup()
                .addContainerGap()
                .add(jPanel7Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jPanel7Layout.createSequentialGroup()
                        .add(jLabel16)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                        .add(jSpinField2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 62, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                        .add(27, 27, 27)
                        .add(jLabel17)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jSpinField3, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 62, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                    .add(jPanel7Layout.createSequentialGroup()
                        .add(jLabel18)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                        .add(jComboBox2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 218, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel7Layout.setVerticalGroup(
            jPanel7Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel7Layout.createSequentialGroup()
                .add(jPanel7Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jPanel7Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                        .add(jLabel16)
                        .add(jLabel17))
                    .add(jSpinField2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(jSpinField3, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel7Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel18)
                    .add(jComboBox2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(0, 8, Short.MAX_VALUE))
        );

        jTextField9.setEditable(false);
        jTextField9.setText("jTextField9");

        jTextField10.setEditable(false);
        jTextField10.setText("jTextField9");
        jTextField10.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTextField10MouseClicked(evt);
            }
        });
        jTextField10.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField10ActionPerformed(evt);
            }
        });
        jTextField10.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTextField10KeyReleased(evt);
            }
        });

        jTextField11.setEditable(false);
        jTextField11.setText("jTextField9");
        jTextField11.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTextField11MouseClicked(evt);
            }
        });
        jTextField11.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTextField11KeyPressed(evt);
            }
        });

        jCheckBox7.setText("Deixa registre en la fitxa de l'alumne");
        jCheckBox7.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBox7ActionPerformed(evt);
            }
        });

        jLabel19.setText("Enviament de carta");

        jTextField14.setText("jTextField9");
        jTextField14.setToolTipText("S,N, or id of field");
        jTextField14.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField14ActionPerformed(evt);
            }
        });

        jTextField15.setText("jTextField9");
        jTextField15.setToolTipText("S,N or id of field");
        jTextField15.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField15ActionPerformed(evt);
            }
        });

        jLabel20.setText("Enviament de SMS");

        jToolBar4.setFloatable(false);

        jEdit2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/edit.gif"))); // NOI18N
        jEdit2.setToolTipText("Edit");
        jEdit2.setFocusable(false);
        jEdit2.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jEdit2.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jEdit2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jEdit2ActionPerformed(evt);
            }
        });
        jToolBar4.add(jEdit2);

        jSave2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/save.gif"))); // NOI18N
        jSave2.setToolTipText("Save");
        jSave2.setEnabled(false);
        jSave2.setFocusable(false);
        jSave2.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jSave2.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jSave2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jSave2ActionPerformed(evt);
            }
        });
        jToolBar4.add(jSave2);

        jCancel2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/exit.gif"))); // NOI18N
        jCancel2.setToolTipText("Cancel");
        jCancel2.setEnabled(false);
        jCancel2.setFocusable(false);
        jCancel2.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jCancel2.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jCancel2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCancel2ActionPerformed(evt);
            }
        });
        jToolBar4.add(jCancel2);

        org.jdesktop.layout.GroupLayout jPanel3Layout = new org.jdesktop.layout.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                    .add(jToolBar4, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel3Layout.createSequentialGroup()
                        .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
                            .add(jPanel3Layout.createSequentialGroup()
                                .add(jLabel14)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                .add(jTextField10))
                            .add(jPanel3Layout.createSequentialGroup()
                                .add(jLabel15)
                                .add(34, 34, 34)
                                .add(jTextField11))
                            .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                                .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel3Layout.createSequentialGroup()
                                    .add(jLabel12)
                                    .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                                    .add(jTextField9, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 59, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                                .add(org.jdesktop.layout.GroupLayout.LEADING, jCheckBox7)
                                .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
                                    .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel3Layout.createSequentialGroup()
                                        .add(jLabel20)
                                        .add(18, 18, 18)
                                        .add(jTextField15))
                                    .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel3Layout.createSequentialGroup()
                                        .add(jLabel19)
                                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                                        .add(jTextField14, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 269, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                                .add(org.jdesktop.layout.GroupLayout.LEADING, jPanel7, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                        .add(0, 375, Short.MAX_VALUE)))
                .add(34, 34, 34))
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel3Layout.createSequentialGroup()
                .add(jToolBar4, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel12)
                    .add(jTextField9, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel14)
                    .add(jTextField10, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel15)
                    .add(jTextField11, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(17, 17, 17)
                .add(jPanel7, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jCheckBox7)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel19)
                    .add(jTextField14, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel20)
                    .add(jTextField15, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(485, Short.MAX_VALUE))
        );

        jScrollPane4.setViewportView(jPanel3);

        jTabbedPane1.addTab("Subrule", jScrollPane4);

        jToolBar1.setFloatable(false);
        jToolBar1.setRollover(true);

        jEdit3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/edit.gif"))); // NOI18N
        jEdit3.setToolTipText("Edit");
        jEdit3.setFocusable(false);
        jEdit3.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jEdit3.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jEdit3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jEdit3ActionPerformed(evt);
            }
        });
        jToolBar1.add(jEdit3);

        jSave3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/save.gif"))); // NOI18N
        jSave3.setToolTipText("Save");
        jSave3.setFocusable(false);
        jSave3.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jSave3.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jSave3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jSave3ActionPerformed(evt);
            }
        });
        jToolBar1.add(jSave3);

        jCancel3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/exit.gif"))); // NOI18N
        jCancel3.setToolTipText("Cancel");
        jCancel3.setFocusable(false);
        jCancel3.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jCancel3.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jCancel3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCancel3ActionPerformed(evt);
            }
        });
        jToolBar1.add(jCancel3);

        jLabel21.setText("Components:");
        jToolBar1.add(jLabel21);

        jComboBox3.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "JRTextField", "JRTextArea", "JRDateChooser", "JRMultiDateChooser", "JRPeriodDateChooser", "JRComboBox{fillwith=(item1", "item2)}", "JRSpinner", "JRCheckBox", "JRRadioButton" }));
        jToolBar1.add(jComboBox3);

        jButton3.setText("<field/>");
        jButton3.setFocusable(false);
        jButton3.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton3.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton3ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton3);

        jButton4.setText("<selectableField/>");
        jButton4.setFocusable(false);
        jButton4.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton4.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton4ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton4);

        jButton5.setText("<param/>");
        jButton5.setFocusable(false);
        jButton5.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton5.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton5ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton5);

        jComboBox8.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Register in iesDigital", "Register in SGD" }));
        jComboBox8.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBox8ActionPerformed(evt);
            }
        });
        jToolBar1.add(jComboBox8);

        jToolBar2.setFloatable(false);
        jToolBar2.setRollover(true);

        jLabel22.setText("Resource Map:");
        jToolBar2.add(jLabel22);

        jComboBox4.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "$TODAY_TXT", "$TODAY", "$HORA", "$STUDENT_NAME", "$STUDENT_GRUP", "$STUDENT_DNI", "$STUDENT_BIRTHDATE", "$STUDENT_ISREPETIDOR", "$PARENT_NAMES", "$TUTOR_NAME", "$HORARI_VISITA", "$EXPEDIENT", "$MAJOREDAT", "$ANYSDECIMAL", "$LIST_OF_INSTRUCTORS", "$ANYACADEMIC", "$ADRECA", "$TELEFON", "$ANYS_DECIMAL", "$CURSACADEMIC", "$AVALUACIO" }));
        jComboBox4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBox4ActionPerformed(evt);
            }
        });
        jToolBar2.add(jComboBox4);

        jButton6.setText("<fieldGroup/>");
        jButton6.setFocusable(false);
        jButton6.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton6.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton6.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton6ActionPerformed(evt);
            }
        });
        jToolBar2.add(jButton6);

        jButton15.setText("<category/>");
        jButton15.setFocusable(false);
        jButton15.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jButton15.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton15.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton15ActionPerformed(evt);
            }
        });
        jToolBar2.add(jButton15);

        jScrollPane9.setViewportView(jEditorPane4);

        org.jdesktop.layout.GroupLayout jPanel8Layout = new org.jdesktop.layout.GroupLayout(jPanel8);
        jPanel8.setLayout(jPanel8Layout);
        jPanel8Layout.setHorizontalGroup(
            jPanel8Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jToolBar1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .add(jToolBar2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .add(jScrollPane9, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)
        );
        jPanel8Layout.setVerticalGroup(
            jPanel8Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel8Layout.createSequentialGroup()
                .add(jToolBar1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .add(2, 2, 2)
                .add(jToolBar2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jScrollPane9, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 341, Short.MAX_VALUE))
        );

        jTabbedPane1.addTab("Form xml", jPanel8);

        com.l2fprod.common.swing.PercentLayout percentLayout2 = new com.l2fprod.common.swing.PercentLayout();
        percentLayout2.setGap(14);
        percentLayout2.setOrientation(1);
        mainPane.setLayout(percentLayout2);
        percentLayout2.setGap(0);

        jTextPane4.setEditable(false);
        jTextPane4.setContentType("text/html"); // NOI18N
        jTextPane4.setToolTipText("Log");
        jScrollPane12.setViewportView(jTextPane4);

        org.jdesktop.layout.GroupLayout jPanel1Layout = new org.jdesktop.layout.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel1Layout.createSequentialGroup()
                .add(2, 2, 2)
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
                    .add(jScrollPane12)
                    .add(org.jdesktop.layout.GroupLayout.LEADING, mainPane, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 810, Short.MAX_VALUE))
                .add(2, 2, 2))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel1Layout.createSequentialGroup()
                .add(mainPane, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 322, Short.MAX_VALUE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jScrollPane12, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 89, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .add(2, 2, 2))
        );

        jScrollPane8.setViewportView(jPanel1);

        jTabbedPane1.addTab("Preview form", jScrollPane8);

        jButton11.setText("+ Add");
        jButton11.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton11ActionPerformed(evt);
            }
        });

        jButton12.setText("- Del");
        jButton12.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton12ActionPerformed(evt);
            }
        });

        jList4.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        jList4.addListSelectionListener(new javax.swing.event.ListSelectionListener() {
            public void valueChanged(javax.swing.event.ListSelectionEvent evt) {
                jList4ValueChanged(evt);
            }
        });
        jScrollPane7.setViewportView(jList4);

        jLabel24.setText("Id");

        jLabel27.setText("Descripció");

        jLabel28.setText("Relative path");

        jTextField12.setEditable(false);
        jTextField12.setText("jTextField12");

        jTextField17.setText("jTextField13");

        jTextField18.setText("jTextField13");
        jTextField18.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTextField18KeyReleased(evt);
            }
        });

        jButton13.setText("···");
        jButton13.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton13ActionPerformed(evt);
            }
        });

        jLabel29.setText("Idioma");

        jComboBox5.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "CA", "ES", "EN", "DE" }));

        jLabel31.setText("Include subreport");

        jComboBox6.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "No", "Faltes", "Amonestacions", "Retards" }));

        jLabel32.setText("Limit inicidències");

        jLabel33.setText("Visibilitat");

        jComboBox7.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "*", "PREF-ADMIN" }));

        jCheckBox8.setText("Marcar com important");

        jCheckBox9.setText("Show popup instructions");
        jCheckBox9.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBox9ActionPerformed(evt);
            }
        });

        jTextArea1.setColumns(20);
        jTextArea1.setRows(5);
        jScrollPane6.setViewportView(jTextArea1);

        jToolBar5.setFloatable(false);

        jEdit4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/edit.gif"))); // NOI18N
        jEdit4.setToolTipText("Edit");
        jEdit4.setFocusable(false);
        jEdit4.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jEdit4.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jEdit4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jEdit4ActionPerformed(evt);
            }
        });
        jToolBar5.add(jEdit4);

        jSave4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/save.gif"))); // NOI18N
        jSave4.setToolTipText("Save");
        jSave4.setEnabled(false);
        jSave4.setFocusable(false);
        jSave4.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jSave4.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jSave4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jSave4ActionPerformed(evt);
            }
        });
        jToolBar5.add(jSave4);

        jCancel4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/exit.gif"))); // NOI18N
        jCancel4.setToolTipText("Cancel");
        jCancel4.setEnabled(false);
        jCancel4.setFocusCycleRoot(true);
        jCancel4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCancel4ActionPerformed(evt);
            }
        });
        jToolBar5.add(jCancel4);

        jButton14.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/editable.gif"))); // NOI18N
        jButton14.setText("Edit Report");
        jButton14.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);
        jButton14.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton14ActionPerformed(evt);
            }
        });
        jToolBar5.add(jButton14);

        jButton16.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/configIcon.gif"))); // NOI18N
        jButton16.setText("Compile");
        jButton16.setFocusable(false);
        jButton16.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);
        jButton16.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton16ActionPerformed(evt);
            }
        });
        jToolBar5.add(jButton16);

        jLinkButton1.setForeground(new java.awt.Color(255, 0, 0));
        jLinkButton1.setText("Error. This report file doesn't exist  <Press to create it>");
        jLinkButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jLinkButton1ActionPerformed(evt);
            }
        });

        jLinkButton2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/org/iesapp/apps/administrador/icons/atention.png"))); // NOI18N

        org.jdesktop.layout.GroupLayout jPanel10Layout = new org.jdesktop.layout.GroupLayout(jPanel10);
        jPanel10.setLayout(jPanel10Layout);
        jPanel10Layout.setHorizontalGroup(
            jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jToolBar5, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .add(jPanel10Layout.createSequentialGroup()
                .addContainerGap()
                .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jPanel10Layout.createSequentialGroup()
                        .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(jScrollPane6)
                            .add(jPanel10Layout.createSequentialGroup()
                                .add(jLabel28)
                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                                .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                    .add(jLinkButton1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                    .add(jPanel10Layout.createSequentialGroup()
                                        .add(jTextField18, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 357, Short.MAX_VALUE)
                                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                        .add(jButton13)
                                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                                        .add(jLinkButton2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                        .add(9, 9, 9))))
                            .add(jPanel10Layout.createSequentialGroup()
                                .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                    .add(jCheckBox9)
                                    .add(jPanel10Layout.createSequentialGroup()
                                        .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                            .add(jLabel31)
                                            .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                                                .add(jLabel33)
                                                .add(jCheckBox8)))
                                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                        .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
                                            .add(jPanel10Layout.createSequentialGroup()
                                                .add(jComboBox6, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 97, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                                .add(18, 18, 18)
                                                .add(jLabel32)
                                                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                                                .add(jSpinField4, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 58, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                                            .add(jComboBox7, 0, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                                    .add(jPanel10Layout.createSequentialGroup()
                                        .add(jLabel29)
                                        .add(99, 99, 99)
                                        .add(jComboBox5, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 97, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)))
                                .add(9, 9, 9)))
                        .addContainerGap())
                    .add(jPanel10Layout.createSequentialGroup()
                        .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(jLabel27)
                            .add(jLabel24))
                        .add(27, 27, 27)
                        .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(jPanel10Layout.createSequentialGroup()
                                .add(jTextField12)
                                .add(254, 254, 254))
                            .add(jPanel10Layout.createSequentialGroup()
                                .add(jTextField17)
                                .addContainerGap())))))
        );
        jPanel10Layout.setVerticalGroup(
            jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel10Layout.createSequentialGroup()
                .add(jToolBar5, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel24)
                    .add(jTextField12, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(5, 5, 5)
                .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel27)
                    .add(jTextField17, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(5, 5, 5)
                .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel28)
                    .add(jTextField18, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(jButton13)
                    .add(jLinkButton2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 23, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(1, 1, 1)
                .add(jLinkButton1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .add(2, 2, 2)
                .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(jLabel29)
                    .add(jComboBox5, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                        .add(jLabel31)
                        .add(jComboBox6, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                        .add(jLabel32))
                    .add(jSpinField4, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel10Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jLabel33)
                    .add(jComboBox7, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jCheckBox8)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                .add(jCheckBox9)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
                .add(jScrollPane6, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        org.jdesktop.layout.GroupLayout jPanel9Layout = new org.jdesktop.layout.GroupLayout(jPanel9);
        jPanel9.setLayout(jPanel9Layout);
        jPanel9Layout.setHorizontalGroup(
            jPanel9Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel9Layout.createSequentialGroup()
                .add(jPanel9Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jPanel9Layout.createSequentialGroup()
                        .add(jButton11)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jButton12))
                    .add(jScrollPane7, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 218, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel10, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .add(10, 10, 10))
        );
        jPanel9Layout.setVerticalGroup(
            jPanel9Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel9Layout.createSequentialGroup()
                .add(jPanel9Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jPanel9Layout.createSequentialGroup()
                        .add(jPanel9Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                            .add(jButton11)
                            .add(jButton12))
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jScrollPane7))
                    .add(jPanel9Layout.createSequentialGroup()
                        .addContainerGap()
                        .add(jPanel10, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                .add(312, 312, 312))
        );

        jTabbedPane1.addTab("Reports", jPanel9);

        jButton7.setText("+ Add");
        jButton7.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton7ActionPerformed(evt);
            }
        });

        jButton8.setText("- Del");
        jButton8.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton8ActionPerformed(evt);
            }
        });

        jButton9.setText("+ Add");
        jButton9.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton9ActionPerformed(evt);
            }
        });

        jButton10.setText("- Del");
        jButton10.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton10ActionPerformed(evt);
            }
        });

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentContainer());
        getContentContainer().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .addContainerGap()
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING, false)
                    .add(layout.createSequentialGroup()
                        .add(jLabel1)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jButton7)
                        .add(7, 7, 7)
                        .add(jButton8))
                    .add(layout.createSequentialGroup()
                        .add(jLabel2)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jButton9)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jButton10))
                    .add(jScrollPane2)
                    .add(jScrollPane1))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jTabbedPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 817, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(layout.createSequentialGroup()
                        .add(1, 1, 1)
                        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                            .add(jLabel1)
                            .add(jButton7)
                            .add(jButton8))
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 184, Short.MAX_VALUE)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                            .add(jLabel2)
                            .add(jButton9)
                            .add(jButton10))
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(jScrollPane2, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 183, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                    .add(layout.createSequentialGroup()
                        .add(5, 5, 5)
                        .add(jTabbedPane1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)))
                .add(5, 5, 5))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void jTextField1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField1ActionPerformed

    private void jTextField7ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField7ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField7ActionPerformed

    private void jTextField14ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField14ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField14ActionPerformed

    private void jTextField15ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField15ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField15ActionPerformed

    private void jList1ValueChanged(javax.swing.event.ListSelectionEvent evt) {//GEN-FIRST:event_jList1ValueChanged
        
         
         this.idMain = jList1.getSelectedIndex();
         this.pointerMain = allRules.get(idMain);
         this.pointerMain.forceLoading();   //Acaba de carregar-la ja que s'ha fet lazy loading
        
         updateGeneralRuleForms();
               
         modelList2 = new DefaultListModel();
         int id = jList1.getSelectedIndex();
         for(int i=0; i<allRules.get(id).getSubRules().size(); i++)
         {
            BeanSubRule sbr = allRules.get(id).getSubRules().get(i);
            modelList2.addElement(sbr.getId()+" : "+sbr.getAmbits()+" | "+sbr.getEstudis());
         }
         jList2.setModel(modelList2);
         if(!modelList2.isEmpty())
         {
             jList2.setSelectedIndex(0);             
         }
         checkOverlap();
    }//GEN-LAST:event_jList1ValueChanged

    //Update values of subrule
    private void jList2ValueChanged(javax.swing.event.ListSelectionEvent evt) {//GEN-FIRST:event_jList2ValueChanged
         
         this.idSec = jList2.getSelectedIndex();
         if(idMain<0 || idSec<0)
         {
             return;
         }
         
         this.pointerSec = allRules.get(idMain).getSubRules().get(idSec);
        
        updateSubRuleForms();
    }//GEN-LAST:event_jList2ValueChanged

    //New Rule
    private void jButton7ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton7ActionPerformed
        BeanRule beanRule = new BeanRule(cfg);
        beanRule.save();
        allRules.add(beanRule);
        modelList1.addElement(beanRule.getId()+" : "+beanRule.getActuacio());
        modelList2.addElement(beanRule.getSubRules().get(0).getId()+" : "+beanRule.getSubRules().get(0).getAmbits()+" | "+beanRule.getSubRules().get(0).getEstudis());
        jList1.setSelectedIndex(modelList1.size()-1);
        jList1.ensureIndexIsVisible(modelList1.size()-1);
    }//GEN-LAST:event_jButton7ActionPerformed

    private void jTextField1KeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField1KeyTyped
         
    }//GEN-LAST:event_jTextField1KeyTyped

    private void jTextField1KeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField1KeyReleased
         int id = jList1.getSelectedIndex();
         modelList1.setElementAt(jTextField3.getText()+" : "+jTextField1.getText(), id);
    }//GEN-LAST:event_jTextField1KeyReleased

    private void jTextField10ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField10ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField10ActionPerformed

    private void jTextField10KeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField10KeyReleased
        
    }//GEN-LAST:event_jTextField10KeyReleased

    private void jTextField11KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField11KeyPressed
        
    }//GEN-LAST:event_jTextField11KeyPressed

    private void jButton8ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton8ActionPerformed
      int id = jList1.getSelectedIndex();
      if(id<0) {
            return;
        }
      
      //Confirmation
        int seleccion = JOptionPane.showOptionDialog(this,
                "Vol elminar aquesta regla?",
                "Confirmació",
                JOptionPane.YES_NO_CANCEL_OPTION,
                JOptionPane.QUESTION_MESSAGE,
                null, // null para icono por defecto.
                new Object[]{"Si", "No"}, // null para YES, NO y CANCEL
                "No");

        if(seleccion!=0)
        {
            return;
        }
      
      
      if(id>0)
      {
          jList1.setSelectedIndex(id-1);
      }
      else
      {
        if(modelList1.getSize()>0) {
            jList1.setSelectedIndex(0);
        }
      }
      
      allRules.get(id).delete();
      allRules.remove(id);
      modelList1.remove(id);
          
    }//GEN-LAST:event_jButton8ActionPerformed

    private void jButton9ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton9ActionPerformed
        int id=jList1.getSelectedIndex();
        int idRule = allRules.get(id).getId();
        BeanSubRule bsr = new BeanSubRule(cfg);
        bsr.setIdRule(idRule);
        bsr.save();
        allRules.get(id).getSubRules().add(bsr);
        modelList2.addElement(bsr.getId()+" : "+bsr.getAmbits()+" | "+bsr.getEstudis());
        jList2.setSelectedIndex(modelList2.getSize()-1);
        jList2.ensureIndexIsVisible(modelList2.getSize()-1);
        checkOverlap();
    }//GEN-LAST:event_jButton9ActionPerformed

    private void jButton10ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton10ActionPerformed
      if(modelList2.getSize()<=1)
      {
          return;
      }
      int id1 = jList1.getSelectedIndex();
      int id2 = jList2.getSelectedIndex();
      
      
      if(id2>0)
      {
          jList2.setSelectedIndex(id2-1);
      }
      else
      {
        if(modelList2.getSize()>0) {
            jList2.setSelectedIndex(0);
        }
      }
      
      allRules.get(id1).getSubRules().get(id2).delete();
      allRules.get(id1).getSubRules().remove(id2);
      modelList2.remove(id2);
      checkOverlap();
    }//GEN-LAST:event_jButton10ActionPerformed

    private void jList4ValueChanged(javax.swing.event.ListSelectionEvent evt) {//GEN-FIRST:event_jList4ValueChanged
      
        this.idRep = jList4.getSelectedIndex();
        if (idMain < 0 || idRep < 0 || idSec < 0) {
            return;
        }
        this.pointerRep = allRules.get(idMain).getSubRules().get(idSec).getReports().get(idRep);
        updateReportForm();
    }//GEN-LAST:event_jList4ValueChanged

    //Choose report
    private void jButton13ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton13ActionPerformed
        JFileChooser fchooser = new JFileChooser();
        fchooser.setFileFilter(new FileFilter(){

            @Override
            public boolean accept(File f) {
               return f.getAbsolutePath().endsWith(".jrxml") || f.isDirectory();
            }

            @Override
            public String getDescription() {
                return "Jasper report files (*.jrxml)";
            }
        });
        
        fchooser.setFileSelectionMode(JFileChooser.FILES_ONLY);
        fchooser.setCurrentDirectory(lastDir);
        int show = fchooser.showOpenDialog(this);
        if(show==JFileChooser.APPROVE_OPTION)
        {
            File selectedFile = fchooser.getSelectedFile();
            String relative = StringUtils.AfterLast(selectedFile.getAbsolutePath(), CoreCfg.contextRoot+"\\reports\\");
            relative = StringUtils.BeforeLast(relative,".");
            jTextField18.setText(relative);
            lastDir = selectedFile.getParentFile();
        }
    }//GEN-LAST:event_jButton13ActionPerformed

    private void jTabbedPane1StateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_jTabbedPane1StateChanged
        if(!isListening) 
        {
            return;
        }       
        if(jTabbedPane1.getSelectedIndex()==3)
        {
            this.saveCurrentSubRuleBean();       
            this.makeFormPreview();
        }
    }//GEN-LAST:event_jTabbedPane1StateChanged

    private void jEdit1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jEdit1ActionPerformed
       jEdit1.setEnabled(false);
       jSave1.setEnabled(true);
       jCancel1.setEnabled(true);
       this.enableGeneralRuleForms(true);
       enableSwitching(false);
    }//GEN-LAST:event_jEdit1ActionPerformed

    private void jSave1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jSave1ActionPerformed
       jEdit1.setEnabled(true);
       jSave1.setEnabled(false);
       jCancel1.setEnabled(false);
       
       this.saveCurrentMainRuleBean();
       
       this.enableGeneralRuleForms(false);
       enableSwitching(true);
    }//GEN-LAST:event_jSave1ActionPerformed

    private void jCancel1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCancel1ActionPerformed
       jEdit1.setEnabled(true);
       jSave1.setEnabled(false);
       jCancel1.setEnabled(false);
       this.enableGeneralRuleForms(false);
       enableSwitching(true);
    }//GEN-LAST:event_jCancel1ActionPerformed

    private void jCheckBox6ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBox6ActionPerformed
        jTextField8.setEnabled(!jCheckBox6.isSelected());
        jTextField8.setText(null);
    }//GEN-LAST:event_jCheckBox6ActionPerformed

    private void jEdit2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jEdit2ActionPerformed
       jEdit2.setEnabled(false);
       jSave2.setEnabled(true);
       jCancel2.setEnabled(true);
       this.enableSubRuleForm(true);
       enableSwitching(false);
    }//GEN-LAST:event_jEdit2ActionPerformed

    private void jSave2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jSave2ActionPerformed
       jEdit2.setEnabled(true);
       jSave2.setEnabled(false);
       jCancel2.setEnabled(false);
       this.saveCurrentSubRuleBean();
       this.enableSubRuleForm(false);
       enableSwitching(true);
    }//GEN-LAST:event_jSave2ActionPerformed

    private void jCancel2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCancel2ActionPerformed
       jEdit2.setEnabled(true);
       jSave2.setEnabled(false);
       jCancel2.setEnabled(false);
       this.enableSubRuleForm(false);
       enableSwitching(true);
    }//GEN-LAST:event_jCancel2ActionPerformed

    private void jEdit3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jEdit3ActionPerformed
       jEdit3.setEnabled(false);
       jSave3.setEnabled(true);
       jCancel3.setEnabled(true);
       this.enableSubRuleForm(true);
       enableSwitching(false);
    }//GEN-LAST:event_jEdit3ActionPerformed

    private void jSave3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jSave3ActionPerformed
       jEdit3.setEnabled(true);
       jSave3.setEnabled(false);
       jCancel3.setEnabled(false);
       this.saveCurrentSubRuleBean();
       this.enableSubRuleForm(false);
       enableSwitching(true);
    }//GEN-LAST:event_jSave3ActionPerformed

    private void jCancel3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCancel3ActionPerformed
       jEdit3.setEnabled(true);
       jSave3.setEnabled(false);
       jCancel3.setEnabled(false);
       this.enableSubRuleForm(false);
       enableSwitching(true);
    }//GEN-LAST:event_jCancel3ActionPerformed

    private void jEdit4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jEdit4ActionPerformed
       jEdit4.setEnabled(false);
       jSave4.setEnabled(true);
       jCancel4.setEnabled(true);
       this.enableReportForm(true);
       enableSwitching(false);
    }//GEN-LAST:event_jEdit4ActionPerformed

    private void jSave4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jSave4ActionPerformed
       jEdit4.setEnabled(true);
       jSave4.setEnabled(false);
       jCancel4.setEnabled(false);
       this.enableReportForm(false);
       this.saveCurrentReportBean();
       enableSwitching(true);
    }//GEN-LAST:event_jSave4ActionPerformed

    private void jCancel4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCancel4ActionPerformed
       jEdit4.setEnabled(true);
       jSave4.setEnabled(false);
       jCancel4.setEnabled(false);
       this.enableReportForm(false);
       enableSwitching(true);
    }//GEN-LAST:event_jCancel4ActionPerformed

    //New report
    private void jButton11ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton11ActionPerformed
        if(pointerSec==null)
        {
            return;
        }
        BeanReport brep = new BeanReport(cfg);
        brep.setidSubRule(pointerSec.getId());
        pointerSec.getReports().add(brep);
        brep.save();
        modelList4.addElement(brep.getId()+" : "+brep.getReportPath());
        jList4.setSelectedIndex(modelList4.getSize()-1);
        jList4.ensureIndexIsVisible(modelList4.getSize()-1); 
    }//GEN-LAST:event_jButton11ActionPerformed

    //Delete report
    private void jButton12ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton12ActionPerformed
      int id = jList4.getSelectedIndex();
      if(id<0) {
            return;
        }
      
      //Confirmation
        int seleccion = JOptionPane.showOptionDialog(this,
                "Vol elminar aquest report?",
                "Confirmació",
                JOptionPane.YES_NO_CANCEL_OPTION,
                JOptionPane.QUESTION_MESSAGE,
                null, // null para icono por defecto.
                new Object[]{"Si", "No"}, // null para YES, NO y CANCEL
                "No");

        if(seleccion!=0)
        {
            return;
        }
      
      
      if(id>0)
      {
          jList4.setSelectedIndex(id-1);
      }
      else
      {
        if(modelList4.getSize()>0) {
            jList4.setSelectedIndex(0);
        }
      }
      
      pointerSec.getReports().get(id).delete();
      pointerSec.getReports().remove(id);
      modelList4.remove(id);
      
    }//GEN-LAST:event_jButton12ActionPerformed

    private void jButton14ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton14ActionPerformed
        
        if(cfg.ireportPath==null || cfg.ireportPath.isEmpty())
        {
            INotificationStyle style = new DarkDefaultNotification().withWindowCornerRadius(8).withWidth(300).withAlpha(0.86f);

                    // Now lets build the notification
                     new NotificationBuilder().withStyle(style) // Required. here we set the previously set style
                        .withTitle("Error") // Required.
                        .withMessage("ireport path has no been specified.") // Optional
                        .withIcon(new ImageIcon(NotificationBuilder.ICON_EXCLAMATION)) // Optional. You could also use a String path
                        .withDisplayTime(5000) // Optional
                        .withPosition(Positions.NORTH_EAST) // Optional. Show it at the center of the screen
                        .showNotification(); 

            JFileChooser fc = new JFileChooser();
            fc.setFileFilter(new FileFilter() {

                @Override
                public boolean accept(File f) {
                    return f.isDirectory() || f.getAbsolutePath().endsWith(".exe");
                }

                @Override
                public String getDescription() {
                    return "IReport binary (.exe)";
                }
            });
            fc.setMultiSelectionEnabled(false);
            fc.setDialogTitle("Find location of IReport.exe");
            fc.setFileSelectionMode(JFileChooser.FILES_ONLY);
            
            if(fc.showOpenDialog(this)==JFileChooser.APPROVE_OPTION)
            {
                cfg.ireportPath = fc.getSelectedFile().getParent();
                cfg.saveIni();
            }
                     
            return;
        }
        String str ="C:\\IREPORTS\\" + jTextField18.getText() + ".jrxml";
        File f = new File(str);
        if (f.exists()) {
            try {
                String command = "\""+cfg.ireportPath+"\" "+str;
                Process proc = Runtime.getRuntime().exec(command);
            } catch (IOException ex) {
                INotificationStyle style = new DarkDefaultNotification().withWindowCornerRadius(8).withWidth(300).withAlpha(0.86f);

                    // Now lets build the notification
                     new NotificationBuilder().withStyle(style) // Required. here we set the previously set style
                        .withTitle("Error") // Required.
                        .withMessage(ex.toString()) // Optional
                        .withIcon(new ImageIcon(NotificationBuilder.ICON_EXCLAMATION)) // Optional. You could also use a String path
                        .withDisplayTime(5000) // Optional
                        .withPosition(Positions.NORTH_EAST) // Optional. Show it at the center of the screen
                        .showNotification(); 
                
            }
        } else {
            try {
                String command = "\""+cfg.ireportPath+"\"";
                Process proc = Runtime.getRuntime().exec(command);
            } catch (IOException ex) {
                 INotificationStyle style = new DarkDefaultNotification().withWindowCornerRadius(8).withWidth(300).withAlpha(0.86f);

                    // Now lets build the notification
                     new NotificationBuilder().withStyle(style) // Required. here we set the previously set style
                        .withTitle("Error") // Required.
                        .withMessage(ex.toString()) // Optional
                        .withIcon(new ImageIcon(NotificationBuilder.ICON_EXCLAMATION)) // Optional. You could also use a String path
                        .withDisplayTime(5000) // Optional
                        .withPosition(Positions.NORTH_EAST) // Optional. Show it at the center of the screen
                        .showNotification(); 
            }
        }

    }//GEN-LAST:event_jButton14ActionPerformed

    //Edit HTML with SHEF
    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
         HtmlEditorDlg dlg = new HtmlEditorDlg(javar.JRDialog.getActiveFrame(),true,jTextPane3.getText());
         dlg.setLocationRelativeTo(null);
         dlg.setVisible(true);
         if(dlg.getReturnCode()==HtmlEditorDlg.ACCEPT)
         {
             jTextPane3.setText(dlg.getText());
         }
         dlg.dispose();
    }//GEN-LAST:event_jButton1ActionPerformed

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
         HtmlEditorDlg dlg = new HtmlEditorDlg(javar.JRDialog.getActiveFrame(),true,jTextPane2.getText());
         dlg.setLocationRelativeTo(null);
         dlg.setVisible(true);
         if(dlg.getReturnCode()==HtmlEditorDlg.ACCEPT)
         {
             jTextPane2.setText(dlg.getText());
         }
         dlg.dispose();
    }//GEN-LAST:event_jButton2ActionPerformed

    //Insert a field at the given position
    private void jButton3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton3ActionPerformed
        if(jEdit3.isEnabled())
        {
            return;
        }
            
        int n = jEditorPane4.getCaretPosition();
        try{
            long rand1 = Math.round(100*Math.random());            
            String field = "<field id=\"id"+rand1+"\" class=\"javar."+jComboBox3.getSelectedItem()+"\" "
                    + "description=\"\" editable=\"S|P\" iniValue=\"\" required=\"yes\" visible=\"yes\"/>";

            jEditorPane4.getDocument().insertString(n, field, null);
        } catch (BadLocationException ex) {
            Logger.getLogger(RulesManager.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_jButton3ActionPerformed

    private void jButton4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton4ActionPerformed
        if(jEdit3.isEnabled())
        {
            return;
        }
        int n = jEditorPane4.getCaretPosition();
        try {
            long rand1 = Math.round(100*Math.random());
            long rand2 = Math.round(100*Math.random());
            String field = "<selectableField selection=\"idSel"+rand1+"\" id=\"id"+rand2+"\" class=\"javar."+jComboBox3.getSelectedItem()+"\" "
                    + "description=\"\" editable=\"S|P\" iniValue=\"\" required=\"yes\" visible=\"yes\"/>";

            jEditorPane4.getDocument().insertString(n, field, null);
        } catch (BadLocationException ex) {
            Logger.getLogger(RulesManager.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_jButton4ActionPerformed

    private void jButton5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton5ActionPerformed
        if(jEdit3.isEnabled())
        {
            return;
        }
        int n = jEditorPane4.getCaretPosition();
        try {
            long rand1 = Math.round(100*Math.random());     
            String field = "<param id=\"id"+rand1+"\" iniValue=\"\" addToMap=\"yes\"/>";
            jEditorPane4.getDocument().insertString(n, field, null);
        } catch (BadLocationException ex) {
            Logger.getLogger(RulesManager.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_jButton5ActionPerformed

    private void jComboBox8ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jComboBox8ActionPerformed
        if(jEdit3.isEnabled())
        {
            return;
        }  
        String field = "";

        if (jComboBox8.getSelectedIndex() == 0) {

             field =   
            "<register target=\"iesdigital\" type=\"\" dates=\"$VALUE\"/>";
       
         }
         else
         {
            field = 
        "<register target=\"sgd\" simbol=\"\" dates=\"$VALUE\" description=\"\" incpersession=\"1\" allDay=\"no\" />";
       
         }
         
        int n = jEditorPane4.getCaretPosition();
        try {
            jEditorPane4.getDocument().insertString(n, field, null);
        } catch (BadLocationException ex) {
            Logger.getLogger(RulesManager.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_jComboBox8ActionPerformed

    private void jButton6ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton6ActionPerformed
        if(jEdit3.isEnabled())
        {
            return;
        }
        int n = jEditorPane4.getCaretPosition();
        try {
            String field = "<fieldGroup id=\"id\" elements=\"\"/>";
            jEditorPane4.getDocument().insertString(n, field, null);
        } catch (BadLocationException ex) {
            Logger.getLogger(RulesManager.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_jButton6ActionPerformed

    private void jComboBox4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jComboBox4ActionPerformed
        if(jEdit3.isEnabled())
        {
            return;
        }
        
        int n = jEditorPane4.getCaretPosition();
        try {
            
            jEditorPane4.getDocument().insertString(n, (String) jComboBox4.getSelectedItem(), null);
        } catch (BadLocationException ex) {
            Logger.getLogger(RulesManager.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_jComboBox4ActionPerformed

    private void jButton15ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton15ActionPerformed
        if(jEdit3.isEnabled())
        {
            return;
        }
        
        int n = jEditorPane4.getCaretPosition();
        try {
            String category = "<category id=\"id\" title=\"Category title\" collapsable=\"yes\" collapsed=\"no\">\n\n</category>";
            jEditorPane4.getDocument().insertString(n, category, null);
        } catch (BadLocationException ex) {
            Logger.getLogger(RulesManager.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_jButton15ActionPerformed

    private void jCheckBox7ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBox7ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jCheckBox7ActionPerformed

    private void jTextField18KeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextField18KeyReleased
        //Update jList entry in jList4
         modelList4.setElementAt(jTextField18.getText(), jList4.getSelectedIndex());
         checkReport();
    }//GEN-LAST:event_jTextField18KeyReleased

    private void jCheckBox9ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBox9ActionPerformed
        jTextArea1.setEnabled(jCheckBox9.isSelected());        
    }//GEN-LAST:event_jCheckBox9ActionPerformed

    private void jTextField10MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTextField10MouseClicked
         if(!jTextField10.isEnabled())
         {
             return;
         }
         AmbitsChooser dlg = new AmbitsChooser(javar.JRDialog.getActiveFrame(),AmbitsChooser.CHOOSER_ENSENYAMENT,jTextField10.getText(),cfg);
         dlg.setLocationRelativeTo(jTextField10);
         dlg.setVisible(true);
         if(dlg.getExitCode()==AmbitsChooser.CHOOSER_ACCEPT)
         {
             jTextField10.setText(dlg.getSelection());
             int id = jList2.getSelectedIndex();
             modelList2.setElementAt(jTextField9.getText()+" : "+jTextField10.getText()+" | "+jTextField11.getText(), id);
         }
         dlg.dispose();
         checkOverlap();
    }//GEN-LAST:event_jTextField10MouseClicked

    private void jTextField11MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTextField11MouseClicked
          if(!jTextField11.isEnabled())
         {
             return;
         }
         AmbitsChooser dlg = new AmbitsChooser(javar.JRDialog.getActiveFrame(),AmbitsChooser.CHOOSER_ESTUDIS,jTextField11.getText(),cfg);
         dlg.setLocationRelativeTo(jTextField11);
         dlg.setVisible(true);
         if(dlg.getExitCode()==AmbitsChooser.CHOOSER_ACCEPT)
         {
             jTextField11.setText(dlg.getSelection());
             int id = jList2.getSelectedIndex();
             modelList2.setElementAt(jTextField9.getText()+" : "+jTextField10.getText()+" | "+jTextField11.getText(), id);
         }
         dlg.dispose();
         checkOverlap();
    }//GEN-LAST:event_jTextField11MouseClicked

    private void jTextField13MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTextField13MouseClicked
        if(!jTextField13.isEnabled())
        {
            return;
        }
        RolesChooser dlg = new RolesChooser(javar.JRDialog.getActiveFrame(), jTextField13.getText(),cfg.getCoreCfg());
        dlg.setLocationRelativeTo(jTextField13);
        byte showModal = dlg.showModal();
        if(showModal==RolesChooser.CHOOSER_ACCEPT)
        {
            jTextField13.setText(dlg.getSelection());
        }
        dlg.dispose();
            
    }//GEN-LAST:event_jTextField13MouseClicked

    private void jTextField13ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField13ActionPerformed
         // TODO add your handling code here:
    }//GEN-LAST:event_jTextField13ActionPerformed

    private void jCheckBox2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBox2ActionPerformed
        showRepetible();
    }//GEN-LAST:event_jCheckBox2ActionPerformed

    private void jLinkButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jLinkButton1ActionPerformed
         jasperParser.createNewDoc();
         jLinkButton1.setVisible(false);
    }//GEN-LAST:event_jLinkButton1ActionPerformed

    //COMPILE
    private void jButton16ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton16ActionPerformed
        BeanReport rep = allRules.get(idMain).getSubRules().get(idSec).getReports().get(idRep);
        File file = new File(CoreCfg.contextRoot+File.separator+"reports"+File.separator+rep.getReportPath()+".jrxml");
        if(!file.exists())
        {
            return;
        }
        
        int idRule = allRules.get(idMain).getId();
        
        //Make sure it is in the classpath
        if(!initialized)
        {
            File f = new File(CoreCfg.contextRoot+File.separator+"lib"+File.separator+"reports");
            org.iesapp.framework.util.JarClassLoader.getInstance().addDirToClasspath(f);
            initialized = true;
        }
        try {        
            JasperCompileModule.compileFile(file);
        } catch (Exception ex) {
            Logger.getLogger(RulesManager.class.getName()).log(Level.SEVERE, null, ex);
        } 
        
        File file2 = new File(CoreCfg.contextRoot+File.separator+"reports"+File.separator+rep.getReportPath()+".jasper");
        if(file2.exists())
        {
            Date date = new java.util.Date(file2.lastModified());
            DateFormat df = new SimpleDateFormat("dd-MM-yyyy H:m:ss");
            String format = df.format(date);
            jButton16.setText("Compile ("+format+")");
        }
    }//GEN-LAST:event_jButton16ActionPerformed

    public void showRepetible()
    {
        jPanel12.setVisible(jCheckBox2.isSelected());
        if(jCheckBox2.isSelected() && jSpinField6.getValue()==0)
        {
            jSpinField6.setValue(jSpinField1.getValue());
        }
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton10;
    private javax.swing.JButton jButton11;
    private javax.swing.JButton jButton12;
    private javax.swing.JButton jButton13;
    private javax.swing.JButton jButton14;
    private javax.swing.JButton jButton15;
    private javax.swing.JButton jButton16;
    private javax.swing.JButton jButton2;
    private javax.swing.JButton jButton3;
    private javax.swing.JButton jButton4;
    private javax.swing.JButton jButton5;
    private javax.swing.JButton jButton6;
    private javax.swing.JButton jButton7;
    private javax.swing.JButton jButton8;
    private javax.swing.JButton jButton9;
    private javax.swing.JButton jCancel1;
    private javax.swing.JButton jCancel2;
    private javax.swing.JButton jCancel3;
    private javax.swing.JButton jCancel4;
    private javax.swing.JCheckBox jCheckBox1;
    private javax.swing.JCheckBox jCheckBox10;
    private javax.swing.JCheckBox jCheckBox2;
    private javax.swing.JCheckBox jCheckBox3;
    private javax.swing.JCheckBox jCheckBox4;
    private javax.swing.JCheckBox jCheckBox5;
    private javax.swing.JCheckBox jCheckBox6;
    private javax.swing.JCheckBox jCheckBox7;
    private javax.swing.JCheckBox jCheckBox8;
    private javax.swing.JCheckBox jCheckBox9;
    private javax.swing.JComboBox jComboBox1;
    private javax.swing.JComboBox jComboBox2;
    private javax.swing.JComboBox jComboBox3;
    private javax.swing.JComboBox jComboBox4;
    private javax.swing.JComboBox jComboBox5;
    private javax.swing.JComboBox jComboBox6;
    private javax.swing.JComboBox jComboBox7;
    private javax.swing.JComboBox jComboBox8;
    private javax.swing.JComboBox jComboBox9;
    private javax.swing.JButton jEdit1;
    private javax.swing.JButton jEdit2;
    private javax.swing.JButton jEdit3;
    private javax.swing.JButton jEdit4;
    private javax.swing.JEditorPane jEditorPane4;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel17;
    private javax.swing.JLabel jLabel18;
    private javax.swing.JLabel jLabel19;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel20;
    private javax.swing.JLabel jLabel21;
    private javax.swing.JLabel jLabel22;
    private javax.swing.JLabel jLabel23;
    private javax.swing.JLabel jLabel24;
    private javax.swing.JLabel jLabel25;
    private javax.swing.JLabel jLabel26;
    private javax.swing.JLabel jLabel27;
    private javax.swing.JLabel jLabel28;
    private javax.swing.JLabel jLabel29;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel30;
    private javax.swing.JLabel jLabel31;
    private javax.swing.JLabel jLabel32;
    private javax.swing.JLabel jLabel33;
    private javax.swing.JLabel jLabel34;
    private javax.swing.JLabel jLabel35;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private com.l2fprod.common.swing.JLinkButton jLinkButton1;
    private com.l2fprod.common.swing.JLinkButton jLinkButton2;
    private javax.swing.JList jList1;
    private javax.swing.JList jList2;
    private javax.swing.JList jList4;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel10;
    private javax.swing.JPanel jPanel11;
    private javax.swing.JPanel jPanel12;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JButton jSave1;
    private javax.swing.JButton jSave2;
    private javax.swing.JButton jSave3;
    private javax.swing.JButton jSave4;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane10;
    private javax.swing.JScrollPane jScrollPane11;
    private javax.swing.JScrollPane jScrollPane12;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JScrollPane jScrollPane5;
    private javax.swing.JScrollPane jScrollPane6;
    private javax.swing.JScrollPane jScrollPane7;
    private javax.swing.JScrollPane jScrollPane8;
    private javax.swing.JScrollPane jScrollPane9;
    private com.toedter.components.JSpinField jSpinField1;
    private com.toedter.components.JSpinField jSpinField2;
    private com.toedter.components.JSpinField jSpinField3;
    private com.toedter.components.JSpinField jSpinField4;
    private com.toedter.components.JSpinField jSpinField5;
    private com.toedter.components.JSpinField jSpinField6;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JTextArea jTextArea1;
    private javax.swing.JTextField jTextField1;
    private javax.swing.JTextField jTextField10;
    private javax.swing.JTextField jTextField11;
    private javax.swing.JTextField jTextField12;
    private javax.swing.JTextField jTextField13;
    private javax.swing.JTextField jTextField14;
    private javax.swing.JTextField jTextField15;
    private javax.swing.JTextField jTextField16;
    private javax.swing.JTextField jTextField17;
    private javax.swing.JTextField jTextField18;
    private javax.swing.JTextField jTextField19;
    private javax.swing.JTextField jTextField2;
    private javax.swing.JTextField jTextField3;
    private javax.swing.JTextField jTextField5;
    private javax.swing.JTextField jTextField6;
    private javax.swing.JTextField jTextField7;
    private javax.swing.JTextField jTextField8;
    private javax.swing.JTextField jTextField9;
    private javax.swing.JTextPane jTextPane1;
    private javax.swing.JTextPane jTextPane2;
    private javax.swing.JTextPane jTextPane3;
    private javax.swing.JTextPane jTextPane4;
    private javax.swing.JToolBar jToolBar1;
    private javax.swing.JToolBar jToolBar2;
    private javax.swing.JToolBar jToolBar3;
    private javax.swing.JToolBar jToolBar4;
    private javax.swing.JToolBar jToolBar5;
    private com.l2fprod.common.swing.JTaskPane mainPane;
    // End of variables declaration//GEN-END:variables

    private void updateGeneralRuleForms() {
        if(idMain<0) {
            return;
        }
        
        BeanRule mr = allRules.get(idMain);
        jTextField1.setText(mr.getActuacio());
        jTextField2.setText(mr.getDescripcio());
        jTextField3.setText(mr.getId()+"");
        jComboBox1.setSelectedItem(mr.getTipus());
        jCheckBox3.setSelected(mr.isNomesAdmin());
        jTextField13.setText(mr.getForRoles());
        jComboBox9.setSelectedItem(mr.getSimbol());
        jSpinField1.setValue(mr.getThreshold());
        jCheckBox2.setSelected(mr.isRepetir());
        showRepetible();
        jCheckBox10.setSelected(mr.isAlertActuacionsPendents());
        jSpinField6.setValue(mr.getVrepeticio());
        jSpinField5.setValue(mr.getVmax());
        jTextField19.setText(mr.getExtensionsTxt());
        jTextField16.setText(mr.getRequireCreated());
        jTextField5.setText(mr.getRequireClosed());
        jCheckBox1.setSelected(mr.isAutoTancar());
        jTextField7.setText(mr.getEquivalencies());
        jTextField6.setText(mr.getAlert());
        jCheckBox6.setSelected(mr.getClassRepresentator()==null);
        jTextField8.setEnabled(false);
        if(!jCheckBox6.isSelected())
        {
            jTextField8.setText(mr.getClassRepresentator());
            jTextField8.setEnabled(true);
        }
        jCheckBox4.setSelected(mr.getInstruccions()!=null && !mr.getInstruccions().isEmpty());
        jCheckBox5.setSelected(mr.getReglament()!=null && !mr.getReglament().isEmpty());
        if(mr.getReglament()==null)
        {
            jTextPane2.setText(null);
        }
        else
        {
            jTextPane2.setText(mr.getReglament());
        }
        
        if(mr.getInstruccions()==null)
        {
            jTextPane3.setText(null);
        }
        else
        {
            jTextPane3.setText(mr.getInstruccions());
        }
        enableGeneralRuleForms(false);
    }

    
    private void enableGeneralRuleForms(boolean b) {
      
        jTextField3.setEnabled(false);
        jButton1.setEnabled(b);
        jButton2.setEnabled(b);
        jTextField1.setEnabled(b);
        jTextField2.setEnabled(b);
        jComboBox1.setEnabled(b);
        jCheckBox3.setEnabled(b);
        jTextField13.setEnabled(b);
        jComboBox9.setEnabled(b);
        jSpinField1.setEnabled(b);
        jCheckBox2.setEnabled(b);
        jCheckBox10.setEnabled(b);
        jTextField16.setEnabled(b);
        jTextField5.setEnabled(b);
        jCheckBox1.setEnabled(b);
        jTextField7.setEnabled(b);
        jTextField6.setEnabled(b);
        jSpinField5.setEnabled(b);
        jSpinField6.setEnabled(b);
        jTextField19.setEnabled(b);
        
        if(pointerMain!=null)
        {
            jCheckBox4.setEnabled(b);    
            jCheckBox5.setEnabled(b);

            jCheckBox6.setEnabled(b);
            jTextField8.setEnabled(b && jCheckBox6.isSelected());

            //jCheckBox4.setSelected(b && pointerMain.getInstruccions()!=null);
            //jCheckBox5.setSelected(b && pointerMain.getReglament()!=null);
        }
        jTextPane2.setEnabled(b);
        jTextPane3.setEnabled(b);
        
    }
    
     private void enableSubRuleForm(boolean b) {         
       jTextField9.setEnabled(false);
       jComboBox2.setEnabled(b);
       jEditorPane4.setEnabled(b);       
       jTextField10.setEnabled(b);
       jTextField11.setEnabled(b);
       jSpinField2.setEnabled(b);
       jSpinField3.setEnabled(b);
       jCheckBox7.setEnabled(b);
       jTextField14.setEnabled(b);
       jTextField15.setEnabled(b);             
     }

      private void enableReportForm(boolean b) {
    
        jTextField12.setEnabled(false);
        jTextField17.setEnabled(b);
        jTextField18.setEnabled(b);        
        jComboBox5.setEnabled(b);
        jCheckBox9.setEnabled(b);
        jComboBox6.setEnabled(b);
        jSpinField4.setEnabled(b);
        jCheckBox8.setEnabled(b);
        jTextArea1.setEnabled(b);
        jComboBox7.setEnabled(b);
        jButton13.setEnabled(b);
    }

    
    
    private void updateSubRuleForms() {
       if(idMain<0 || idSec<0)
       {
           return;
       }
       BeanSubRule subr = allRules.get(idMain).getSubRules().get(idSec);
       
       jEditorPane4.setText(subr.getForm());
       
       jTextField9.setText(subr.getId()+"");
       jTextField10.setText(subr.getAmbits());
       jTextField11.setText(subr.getEstudis());
       jSpinField2.setValue(subr.getMinAge());
       jSpinField3.setValue(subr.getMaxAge());
       jComboBox2.setSelectedItem(subr.getInstancesPolicy());
       jCheckBox7.setSelected(subr.isRegisterInFitxaAlumne());
       jTextField14.setText(subr.getEnviamentCarta());
       jTextField15.setText(subr.getEnviamentSMS());
       
       
       //Updateja els reports
       updateSubRuleReports();
       
       makeFormPreview();
    }

    private void updateSubRuleReports() {
        if(idMain<0 || idSec<0){
            return;
        }
        
        BeanSubRule subr = allRules.get(idMain).getSubRules().get(idSec);
      
        modelList4 = new DefaultListModel();
        for(BeanReport br: subr.getReports())
        {
            modelList4.addElement(br.getId()+ " : "+br.getReportPath());
        }
        jList4.setModel(modelList4);
        if(modelList4.getSize()>0)
        {
            jList4.setSelectedIndex(0);
            idRep = 0;
        }
        
        this.enableSubRuleForm(false);
        
    }

    private void updateReportForm() {
    
        if(idMain<0 || idSec<0 || idRep<0)
        {
            //Remove fields
            jLinkButton1.setVisible(false);
            jTextField12.setText("");
            jTextField17.setText("");
            jTextField18.setText("");
            jComboBox6.setSelectedItem("No");
            jSpinField4.setValue(0);
            jCheckBox8.setSelected(false);
            jTextArea1.setText("");
            String vis = "*";             
            jComboBox7.setSelectedItem(vis);
            return;
        }
        BeanReport rep = allRules.get(idMain).getSubRules().get(idSec).getReports().get(idRep);
        File file = new File(CoreCfg.contextRoot+File.separator+"reports"+File.separator+rep.getReportPath()+".jasper");
        File file2 = new File(CoreCfg.contextRoot+File.separator+"reports"+File.separator+rep.getReportPath()+".jrxml");
        jButton16.setEnabled(file2.exists());
        if(file.exists())
        {
            DateFormat df = new SimpleDateFormat("dd-MM-yyyy H:m:ss");
            String format = df.format(new java.util.Date(file.lastModified()));
            jButton16.setText("Compile ("+format+")");
        }
        else
        {
            jButton16.setText("Compile");
        }
        jTextField12.setText(rep.getId()+"");
        jTextField17.setText(rep.getReportDescription());
        jTextField18.setText(rep.getReportPath());  
        
        //Check if the report is OK?
        checkReport();
        
        jComboBox5.setSelectedItem(rep.getLang());
        String txt = "";
        if(rep.getIncludeSubReport().equals("N"))
        {
            txt = "No";
        }
        else if(rep.getIncludeSubReport().equals("F"))
        {
            txt = "Faltes";
        }
        else if(rep.getIncludeSubReport().equals("A"))
        {
            txt = "Amonestacions";
        }
        else if(rep.getIncludeSubReport().equals("R"))
        {
            txt = "Retards";
        }
        jComboBox6.setSelectedItem(txt);
        jSpinField4.setValue(rep.getLimitInc());
        jCheckBox8.setSelected(rep.isImportant());
        jTextArea1.setText(rep.getPopupInstructions());
        String vis="*";
        if(rep.getVisibilitat().equalsIgnoreCase("P"))
        {
            vis="PREF-ADMIN";
        } 
        jComboBox7.setSelectedItem(vis);
        this.enableReportForm(false);
    }

    
    private void makeFormPreview() {
        
        mainPane.removeAll();
        if(idMain<0 || idSec<0){
            return;
        }
        int idRule = allRules.get(idMain).getId();
        String ensenyament = allRules.get(idMain).getSubRules().get(idSec).getAmbits();
        String estudis =  allRules.get(idMain).getSubRules().get(idSec).getEstudis();
        
        //Create a fake resource map
        java.util.Date now = new java.util.Date();
        HashMap<String,Object> resourceMap = new HashMap<String,Object>();          
        resourceMap.put("$TODAY_TXT", new DataCtrl().getLongData());
        SimpleDateFormat df = new SimpleDateFormat("dd/MM/yyyy");  
        SimpleDateFormat df2 = new SimpleDateFormat("H:m:s");  
        resourceMap.put("$TODAY", df.format(now));
        resourceMap.put("$HORA", df2.format(now));
        resourceMap.put("$STUDENT_NAME", "John Clease");
        resourceMap.put("$STUDENT_GRUP", "2N BATX A");
        resourceMap.put("$STUDENT_DNI", "12345678");
        resourceMap.put("$STUDENT_BIRTHDATE", "01-01-1950");       
        resourceMap.put("$STUDENT_ISREPETIDOR", "X");
        resourceMap.put("$PARENT_NAMES", "Jonh Father, Name Mother");
        resourceMap.put("$TUTOR_NAME", "My Teacher");
        resourceMap.put("$HORARI_VISITA", "Monday, 11:00-12:00 h");
        resourceMap.put("$EXPEDIENT", "2345");
        resourceMap.put("$MAJOREDAT", "S");
        resourceMap.put("$ANYSDECIMAL", "89");
        ArrayList<String> instructors = new ArrayList<String>();
        instructors.add("<0> Possible instructor 1 [PI1]");
        instructors.add("<0> Possible instructor 2 [PI2]");
        instructors.add("<0> Possible instructor 3 [PI3]");
        instructors.add("<0> Possible instructor 4 [PI4]");
        resourceMap.put("$LIST_OF_INSTRUCTORS", instructors);
        resourceMap.put("$ANYACADEMIC", cfg.getCoreCfg().anyAcademic+"-"+(cfg.getCoreCfg().anyAcademic+1));
        resourceMap.put("$ADRECA", "Fake address, n 1");
        resourceMap.put("$TELEFON", "97144444444");
        resourceMap.put("$ANYS_DECIMAL", "89.4");
        
        resourceMap.put("$CURSACADEMIC", "01/09/"+cfg.getCoreCfg().anyAcademic+" a 31/06/"+(cfg.getCoreCfg().anyAcademic+1));       
        resourceMap.put("$AVALUACIO", ""); //TODO
      
        
        Actuacio act = new Actuacio("ADMIN", null, true, 0, -1, idRule,
            false, true, ensenyament, estudis, resourceMap, cfg.getCoreCfg().getIesClient());
        CreateUI createUI = new CreateUI(mainPane, act, cfg.getCoreCfg());
        mainPane.validate();
        mainPane.repaint();
    }
    
    
    private void saveCurrentSubRuleBean()
    {
       if(idMain<0 || idSec<0)
       {
           return;
       }
       BeanSubRule subr = allRules.get(idMain).getSubRules().get(idSec);
       
       subr.setAmbits(jTextField10.getText());
       subr.setEstudis(jTextField11.getText());
       subr.setForm(jEditorPane4.getText());
       subr.setMinAge(jSpinField2.getValue());
       subr.setMaxAge(jSpinField3.getValue());
       subr.setInstancesPolicy(jComboBox2.getSelectedItem().toString());
       subr.setRegisterInFitxaAlumne(jCheckBox7.isSelected());
       subr.setEnviamentCarta(jTextField14.getText());
       subr.setEnviamentSMS(jTextField15.getText());       
       
       subr.save();
    }
    
    private void saveCurrentMainRuleBean()
    {
       if(idMain<0)
       {
           return;
       }
       BeanRule br = allRules.get(idMain);
       br.setActuacio(jTextField1.getText());
       br.setDescripcio(jTextField2.getText());
       br.setTipus((String) jComboBox1.getSelectedItem());
       br.setNomesAdmin(jCheckBox3.isSelected());
       br.setForRoles(jTextField13.getText());
       br.setSimbol((String) jComboBox9.getSelectedItem());
       br.setThreshold(jSpinField1.getValue());
       br.setVmax(jSpinField5.getValue());
       br.setVrepeticio(jSpinField6.getValue());
       br.setRepetir(jCheckBox2.isSelected());
       br.setAlertActuacionsPendents(jCheckBox10.isSelected());
       br.setRequireCreated(jTextField16.getText());
       br.setRequireClosed(jTextField5.getText());
       br.setAutoTancar(jCheckBox1.isSelected());
       br.setEquivalencies(jTextField7.getText());
       br.setAlert(jTextField6.getText());
       if(jCheckBox6.isSelected())
       {
           br.setClassRepresentator(null);
       }
       else
       {
           br.setClassRepresentator(jTextField8.getText());
       }
       
       if(jCheckBox4.isSelected())
       {
           br.setInstruccions(jTextPane3.getText());
       }
       else
       {
           br.setInstruccions("");
       }
       
       if(jCheckBox5.isSelected())
       {
           br.setReglament(jTextPane2.getText());
       }
       else
       {
           br.setReglament("");
       }
       br.setExtensionsTxt( jTextField19.getText() );
       
       br.save();
         
    }
    
    private void saveCurrentReportBean()
    {
       if(idMain<0 || idSec<0 || idRep<0)
       {
           return;
       }
        
        BeanReport rep = allRules.get(idMain).getSubRules().get(idSec).getReports().get(idRep);
        rep.setReportDescription(jTextField17.getText());
        rep.setReportPath(jTextField18.getText());
        rep.setLang((String) jComboBox5.getSelectedItem());
        
        String txt = (String) jComboBox6.getSelectedItem();
        txt = txt.substring(0, 1).toUpperCase();
        rep.setIncludeSubReport(txt);
        rep.setLimitInc(jSpinField4.getValue());
        rep.setImportant(jCheckBox8.isSelected());
        rep.setPopupInstructions(jTextArea1.getText());
        String txt2 = (String) jComboBox7.getSelectedItem();
        txt2 = txt2.substring(0,1);
        rep.setVisibilitat(txt2);
        
        rep.save();
    }

    private void enableSwitching(boolean b) {
        jList1.setEnabled(b);
        jList2.setEnabled(b);
        jList4.setEnabled(b);
        jTabbedPane1.setEnabled(b);
        
        //prevent create/delete
        jButton7.setEnabled(b);
        jButton8.setEnabled(b);
        jButton9.setEnabled(b);
        jButton10.setEnabled(b);
        jButton11.setEnabled(b);
        jButton12.setEnabled(b);
    }

    private void checkOverlap() {
        int idMain0 = jList1.getSelectedIndex();
        BeanRule currentRule = allRules.get(idMain0);
        boolean isthereoverlap = false;
        for(int i=0; i<currentRule.getSubRules().size(); i++)
        {
             AmbitsChooser ac = new AmbitsChooser(javar.JRDialog.getActiveFrame(), AmbitsChooser.CHOOSER_ESTUDIS,"",cfg);
             isthereoverlap = ac.checkOverlap(currentRule.getSubRules().get(i).getAmbits(), currentRule.getSubRules().get(i).getEstudis());
        }
        jList2.setOpaque(true);
        if (isthereoverlap) {
            jList2.setBackground(Color.red);
            jList2.setToolTipText("Warning: Overlap among entries found.");
        } else {
            jList2.setBackground(Color.white);
            jList2.setToolTipText(null);
        }
       
    }

    private void checkReport() {
        BeanSubRule subRule = allRules.get(idMain).getSubRules().get(idSec);
        BeanReport rep = subRule.getReports().get(idRep);
        File file = new File(CoreCfg.contextRoot+File.separator+"reports"+File.separator+rep.getReportPath()+".jrxml");
        int idRule = allRules.get(idMain).getId();
        jasperParser = new JasperReportParser(file, idRule, subRule.getAmbits(), subRule.getEstudis(), rep, cfg);
        boolean checkExistence = jasperParser.checkExistence();
        jLinkButton1.setVisible(!checkExistence);
        final HashMap<String, String> result = jasperParser.checkParameters();
        boolean warnings = false;
        boolean errors = false;
        for(String msgs: result.values())
        {
            if(msgs.contains("ERROR"))
            {
                errors = true;
            }
            else if(msgs.contains("WARNING"))
            {
                warnings = true;
            }
        }
        jLinkButton2.setVisible(errors);
        if(actionListener!=null)
        {
            jLinkButton2.removeActionListener(actionListener);
        }
        actionListener = new ActionListener(){

            public void actionPerformed(ActionEvent e) {
                FixDlg dlg = new FixDlg(javar.JRDialog.getActiveFrame(), true, jasperParser, result);
                dlg.setLocationRelativeTo(null);
                dlg.setVisible(true);
            }
        };

        jLinkButton2.addActionListener(actionListener);
      }    
   
}
